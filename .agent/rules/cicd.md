---
trigger: always_on
---

# CI/CD & BUILD INTEGRITY RULES
# This file governs the build pipeline, quality gates, and deployment standards.

## 1. Zero-Tolerance Quality Gates

1.  **Build Failure on Error:**
    * The CI pipeline **must immediately halt** upon any compilation error or linting failure.
    * No code with errors is permitted to merge to the `main` or `develop` branches.

2.  **Strict TypeScript & Linting:**
    * **Treat Warnings as Errors:** The CI process must run linting with strict flags (e.g., `eslint --max-warnings=0`). Any linting warning is considered a build failure.
    * **Strict Mode:** TypeScript `strict: true` must be enabled in `tsconfig.json`. The use of `any` is prohibited unless explicitly disabled with a documented reason.

3.  **Mandatory Suppression Protocol:**
    * If a linter rule must be ignored (e.g., `// eslint-disable-next-line`), it **must include a comment** explaining *why* it is safe to ignore.
    * Global suppression of rules (e.g., turning off `no-explicit-any` for the whole project) is strictly prohibited.

## 2. Monorepo CI Strategy (Nx "Affected" Mode)

To ensure speed and efficiency in the Shell+Plugin architecture, the CI pipeline must be "Change Aware."

1.  **The "Affected" Command:**
    * The CI pipeline **must use Nx Affected commands** to only run tasks on projects that have changed.
    * *Standard:* `nx affected:lint`, `nx affected:test`, `nx affected:build`.
    * **Constraint:** A change to the "Shared UI" library must trigger builds for *all* consuming Plugins and the Shell.

2.  **Graph Integrity:**
    * The CI must verify the dependency graph (e.g., `nx graph --file=graph.json`).
    * **Circular Dependencies:** The build must fail if any circular dependencies are detected between libraries or modules.

## 3. Testing Mandates

1.  **Unit & Integration Gates:**
    * A successful build requires passing all unit tests (Jest) for the affected projects.
    * Coverage thresholds (e.g., 80%) must be enforced. If coverage drops below the baseline, the build fails.

2.  **End-to-End (E2E) Smoke Tests:**
    * Before a merge, a headless E2E suite (e.g., Cypress/Playwright) must run against the Shell loading the affected Plugin to ensure the integration does not crash the Host.

## 4. Build Artifacts & Deployment

1.  **Immutable Artifacts (Docker):**
    * The output of a successful build must be a **versioned Docker Image** (or static asset bundle).
    * **Reproducibility:** Builds must occur inside a containerized agent to ensuring environment consistency.

2.  **Provenance & Signing:**
    * Production images must be tagged with the Git Commit SHA (`sha-${GITHUB_SHA}`).
    * Where applicable, artifacts should be signed/attested to verify they were generated by the trusted CI system.